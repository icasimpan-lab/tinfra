srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = .

MAKEFOO=@MAKEFOO@
CC=@CC@
CXX=@CXX@

# components
tinfra_DIR      = .
tinfra_test_DIR = .

# tinfra definitions (should be in libfoo/component_defs.mk)
tinfra_HEADERS = \
	tinfra/adaptable.h \
	tinfra/any.h \
	tinfra/assert.h \
	tinfra/buffer.h \
	tinfra/buffered_stream.h \
	tinfra/cli.h \
	tinfra/cmd.h \
	tinfra/config.h \
	tinfra/db.h \
	tinfra/exeinfo.h \
	tinfra/fail.h \
	tinfra/fmt.h \
	tinfra/fs.h \
	tinfra/fs_sandbox.h \
	tinfra/generator.h \
	tinfra/guard.h \
	tinfra/holder.h \
	tinfra/inifile.h \
	tinfra/internal_pipe.h \
	tinfra/interruptible.h \
	tinfra/lazy_protocol.h \
	tinfra/lex.h \
	tinfra/logger.h \
	tinfra/memory_pool.h \
	tinfra/mo.h \
	tinfra/mo_algo.h \
	tinfra/multitype_map.h \
	tinfra/mutex.h \
	tinfra/option.h \
	tinfra/os_common.h \
	tinfra/path.h \
	tinfra/platform.h \
	tinfra/primitive_wrapper.h \
	tinfra/queue.h \
	tinfra/runner.h \
	tinfra/runtime.h \
	tinfra/server.h \
	tinfra/shared_ptr.h \
	tinfra/socket.h \
	tinfra/static_registry.h \
	tinfra/stream.h \
	tinfra/string.h \
	tinfra/structure_printer.h \
	tinfra/subprocess.h \
	tinfra/symbol.h \
	tinfra/tcp_socket.h \
	tinfra/test.h \
	tinfra/test_macros.h \
	tinfra/text.h \
	tinfra/thread.h \
	tinfra/thread_runner.h \
	tinfra/trace.h \
	tinfra/tstring.h \
	tinfra/typeinfo.h \
	tinfra/unix_socket.h \
	tinfra/value_guard.h \
	tinfra/vfs.h \
	tinfra/win32.h

tinfra_SOURCES = \
	tinfra/symbol.cpp \
	tinfra/runtime.cpp \
	tinfra/exeinfo.cpp \
	tinfra/cmd.cpp \
	tinfra/cli.cpp \
	tinfra/io/stream.cpp \
	tinfra/subprocess.cpp \
	tinfra/server.cpp \
	tinfra/fmt.cpp \
	tinfra/string.cpp \
	tinfra/tstring.cpp \
	tinfra/path.cpp \
	tinfra/fs.cpp \
	tinfra/fs_sandbox.cpp \
	tinfra/threadcmn.cpp \
	tinfra/runner.cpp \
	tinfra/os_common.cpp \
	tinfra/trace.cpp \
	tinfra/lazy_protocol.cpp \
	tinfra/vfs.cpp \
	tinfra/option.cpp \
	tinfra/adaptable.cpp \
	tinfra/any.cpp \
	tinfra/typeinfo.cpp \
	tinfra/stream.cpp \
	tinfra/buffered_stream.cpp \
	tinfra/inifile.cpp \
	tinfra/socket.cpp \
	tinfra/tcp_socket.cpp \
	tinfra/internal_pipe.cpp \
	tinfra/assert.cpp \
	tinfra/text.cpp \
	tinfra/fail.cpp \
	tinfra/logger.cpp \
	tinfra/posix/posix_io.cpp \
	tinfra/posix/posix_subprocess.cpp \
	tinfra/posix/thread.cpp \
	tinfra/posix/posix_runtime.cpp \
	tinfra/posix/posix_fs.cpp \
	tinfra/posix/posix_stream.cpp \
	tinfra/win32/w32_stacktrace.cpp \
	tinfra/win32/w32_io.cpp \
	tinfra/win32/w32_subprocess.cpp \
	tinfra/win32/w32_common.cpp \
	tinfra/win32/thread.cpp \
	tinfra/win32/w32_runtime.cpp \
	tinfra/win32/w32_fs.cpp \
	tinfra/win32/w32_stream.cpp


tinfra_test_SOURCES  = \
	tinfra/test.cpp \
	tinfra/test.h \
	tinfra/test_macros.h

SHARED_LIBRARIES += tinfra
STATIC_LIBRARIES += tinfra

SHARED_LIBRARIES += tinfra_test
STATIC_LIBRARIES += tinfra_test

tinfra_CXXFLAGS = -I$(top_srcdir)
tinfra_test_CXXFLAGS = -I$(top_srcdir)
tinfra_test_program_CXXFLAGS = -I$(top_srcdir)
tinfra_test_program_LDFLAGS = -L. -ltinfra -ltinfra-test -lpthread

#TBD, tests/fatal_exception_test.cpp

tinfra_TEST_SOURCES = \
	tests/adaptable_test.cpp \
	tests/any_test.cpp \
	tests/assert_test.cpp \
	tests/buffer_test.cpp \
	tests/buffered_stream_test.cpp \
	tests/exeinfo_test.cpp \
	tests/fmt_test.cpp \
	tests/fs_test.cpp \
	tests/inifile_test.cpp \
	tests/internal_pipe_test.cpp \
	tests/lex_test.cpp \
	tests/logger_test.cpp \
	tests/memory_pool_test.cpp \
	tests/memory_stream_test.cpp \
	tests/mo_algo_test.cpp \
	tests/mo_test.cpp \
	tests/multitype_map_test.cpp \
	tests/option_test.cpp \
	tests/path_test.cpp \
	tests/queue_test.cpp \
	tests/runner_test.cpp \
	tests/runtime_test.cpp \
	tests/server_test.cpp \
	tests/shared_ptr_test.cpp \
	tests/stream_test.cpp \
	tests/string_test.cpp \
	tests/structure_printer_test.cpp \
	tests/subprocess_test.cpp \
	tests/symbol_test.cpp \
	tests/tcp_socket_test.cpp \
	tests/test_macros_test.cpp \
	tests/test_main.cpp \
	tests/test_test.cpp \
	tests/text_test.cpp \
	tests/thread_test.cpp \
	tests/trace_test.cpp \
	tests/tstring_test.cpp


#TEST_PROGRAMS += tinfra

# locate makefoo components
# in production it should look like this
#MAKEFOO=$(top_srcdir)/makefoo
# but in tests we're testing current source tree
#MAKEFOO=$(top_srcdir)/../../
tinfra_COMPONENTS=tinfra tinfra_test
PACKAGES=tinfra

MAKEFOO_USE += native
MAKEFOO_USE += test-program
MAKEFOO_USE += install-fhs
MAKEFOO_USE += rpm
MAKEFOO_USE += autoconf
 
include $(MAKEFOO)/main.mk

# jedit: :tabSize=8:mode=makefile:

